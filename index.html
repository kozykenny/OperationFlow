<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokyo Girls Hub - Welcome</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 50%, #ffffff 100%);
            color: #4b5563;
        }
        .page { display: none; }
        .page.active { display: flex; }
        .card {
            position: relative;
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(236, 72, 153, 0.2);
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 10px 25px -5px rgba(236, 72, 153, 0.1), 0 8px 10px -6px rgba(236, 72, 153, 0.1);
            width: 100%;
            max-width: 550px;
        }
        .btn {
            display: inline-block; padding: 0.85rem 1.75rem; border-radius: 0.75rem; font-weight: 600; text-align: center; transition: all 0.2s ease-in-out; cursor: pointer; border: 1px solid transparent;
        }
        .btn:disabled { background-color: #f3f4f6; color: #9ca3af; cursor: not-allowed; }
        .btn-primary { background-color: #EC4899; color: white; }
        .btn-primary:hover:not(:disabled) { background-color: #db2777; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3); }
        .btn-secondary { background-color: #fce7f3; color: #db2777; border-color: #fbcfe8; }
        .btn-secondary:hover { background-color: #fbcfe8; }
        .logo { font-size: 2rem; font-weight: 700; color: #EC4899; text-align: center; margin-bottom: 1.5rem; }
        .service-card { background-color: #fce7f3; border-radius: 0.75rem; overflow: hidden; text-align: center; color: #be185d; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .service-card img { width: 100%; height: 100px; object-fit: cover; }
        .service-card p { padding: 0.75rem; }
        .back-button { position: absolute; top: 1.5rem; left: 1.5rem; background: none; border: none; cursor: pointer; color: #9ca3af; font-weight: 600; font-size: 1.5rem; line-height: 1; }
        .back-button:hover { color: #EC4899; }
        .legal-text { line-height: 1.7; }

        /* --- CHAT WIDGET STYLES --- */
        #chat-bubble { position: fixed; bottom: 2rem; right: 2rem; width: 60px; height: 60px; background-color: #EC4899; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: pointer; transition: transform 0.2s ease-in-out; z-index: 1000; }
        #chat-bubble:hover { transform: scale(1.1); }
        #chat-widget { position: fixed; bottom: 6.5rem; right: 2rem; width: 350px; max-width: 90vw; height: 500px; background-color: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; z-index: 1000; transform: translateY(20px); opacity: 0; pointer-events: none; transition: all 0.3s ease-in-out; }
        #chat-widget.active { transform: translateY(0); opacity: 1; pointer-events: auto; }
        #chat-header { background-color: #fbcfe8; padding: 1rem; text-align: center; font-weight: 600; color: #be185d; }
        #chat-messages { flex-grow: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 0.75rem; }
        .chat-message { max-width: 80%; padding: 0.5rem 0.75rem; border-radius: 0.75rem; line-height: 1.4; }
        .user-message { background-color: #EC4899; color: white; align-self: flex-end; border-bottom-right-radius: 0; }
        .ai-message { background-color: #f3f4f6; color: #374151; align-self: flex-start; border-bottom-left-radius: 0; }
        #chat-input-area { display: flex; padding: 1rem; border-top: 1px solid #e5e7eb; gap: 0.5rem; }
        #chat-input { flex-grow: 1; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.5rem 0.75rem; }
        #chat-input:focus { outline: none; border-color: #EC4899; box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.2); }
        .chat-btn { flex-shrink: 0; width: 40px; height: 40px; border: none; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background-color 0.2s; }
        #mic-btn { background-color: #f3f4f6; color: #4b5563; }
        #send-btn { background-color: #EC4899; color: white; }

        /* --- VOICE RECORDING OVERLAY --- */
        #voice-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 2000; flex-direction: column; }
        #voice-visualizer { width: 150px; height: 150px; border-radius: 50%; background-color: #EC4899; display: flex; align-items: center; justify-content: center; transition: transform 0.1s ease-out; }
        #stop-recording-btn { margin-top: 3rem; background: none; border: 2px solid white; color: white; width: 80px; height: 80px; border-radius: 50%; font-size: 1rem; font-weight: 600; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app-container" class="w-full">
        <!-- Page 1: Language Selection -->
        <div id="page-language" class="page active flex-col items-center">
            <div class="card">
                <h1 class="logo">Tokyo Girls Hub</h1>
                <h2 class="text-xl font-bold text-center mb-4" data-translate-key="select_language_title">Select Your Language</h2>
                <div class="flex flex-col space-y-4">
                    <select id="language-select" class="w-full p-3 bg-white border border-pink-200 rounded-lg focus:ring-pink-500 focus:border-pink-500 text-center">
                        <!-- Options populated by JS -->
                    </select>
                    <button id="language-continue-btn" class="btn btn-primary" data-translate-key="continue_btn">Continue</button>
                </div>
            </div>
        </div>

        <!-- All other pages remain the same -->
        <div id="page-first-time" class="page flex-col items-center"><div class="card"><button onclick="goBack()" class="back-button" data-translate-key="back_btn">â€¹</button><h1 class="logo" data-translate-key="welcome">Welcome</h1><h2 class="text-2xl font-bold text-center mb-6" data-translate-key="first_time_title">Is this your first time visiting us?</h2><div class="flex justify-around"><button onclick="showPage('page-services')" class="btn btn-primary w-2/5" data-translate-key="yes_btn">Yes</button><button onclick="showPage('page-which-girl')" class="btn btn-secondary w-2/5" data-translate-key="no_btn">No</button></div></div></div>
        <div id="page-services" class="page flex-col items-center"><div class="card"><button onclick="goBack()" class="back-button" data-translate-key="back_btn">â€¹</button><h1 class="logo" data-translate-key="our_services_title">Our Services</h1><p class="text-center mb-4" data-translate-key="our_services_subtitle">We are a legally registered agency. We offer the following services:</p><div class="grid grid-cols-3 gap-4 mb-6"></div><div class="text-center"><button onclick="showPage('page-disclaimer-yes')" class="btn btn-primary" data-translate-key="ok_btn">OK</button></div></div></div>
        <div id="page-disclaimer-yes" class="page flex-col items-center"><div class="card"><button onclick="goBack()" class="back-button" data-translate-key="back_btn">â€¹</button><h1 class="logo text-red-500" data-translate-key="legal_reminder_title">Legal Reminder</h1><div class="text-md space-y-4 mb-6 text-center legal-text" data-translate-key="legal_reminder_text"></div><div class="flex justify-around"><button onclick="redirectToBooking()" class="btn btn-primary w-2/5" data-translate-key="confirm_btn">Confirm</button><button onclick="handleRejection()" class="btn btn-secondary w-2/5" data-translate-key="reject_btn">Reject</button></div></div></div>
        <div id="page-rejected" class="page flex-col items-center"><div class="card"><h1 class="logo" data-translate-key="thank_you">Thank You</h1><p class="text-center text-lg" data-translate-key="rejection_text">Thanks for your interest. We hope to see you again. Redirecting...</p></div></div>
        <div id="page-which-girl" class="page flex-col items-center"><div class="card"><button onclick="goBack()" class="back-button" data-translate-key="back_btn">â€¹</button><h1 class="logo" data-translate-key="welcome_back">Welcome Back!</h1><h2 class="text-xl font-bold text-center mb-4" data-translate-key="which_girl_title">Which girl did you choose last time?</h2><p class="text-center text-sm mb-6" data-translate-key="which_girl_subtitle">Let us know so we can prepare for your visit.</p><form id="girl-nomination-form"><div class="flex flex-col space-y-4"><input type="text" name="girl_name" data-translate-key="girl_name_placeholder" placeholder="Enter name or 'Not Sure'" class="w-full p-3 bg-white border border-pink-200 rounded-lg focus:ring-pink-500 focus:border-pink-500" required><button type="submit" class="btn btn-primary" data-translate-key="submit_continue_btn">Submit & Continue</button></div></form></div></div>
        <div id="page-disclaimer-no" class="page flex-col items-center"><div class="card"><button onclick="goBack()" class="back-button" data-translate-key="back_btn">â€¹</button><h1 class="logo text-red-500" data-translate-key="legal_reminder_title">Legal Reminder</h1><div class="text-md space-y-4 mb-6 text-center legal-text" data-translate-key="legal_reminder_text"></div><div class="flex justify-around"><button onclick="redirectToBooking()" class="btn btn-primary w-2/5" data-translate-key="confirm_btn">Confirm</button><button onclick="handleRejection()" class="btn btn-secondary w-2/5" data-translate-key="reject_btn">Reject</button></div></div></div>
        <div id="page-form-success" class="page flex-col items-center"><div class="card text-center"><button onclick="goBack()" class="back-button" data-translate-key="back_btn">â€¹</button><h1 class="logo" data-translate-key="thank_you">Thank You!</h1><p class="text-lg mb-4" data-translate-key="form_success_text">Your preference has been noted.</p><p class="mb-6" data-translate-key="form_success_subtitle">Please proceed to the disclaimer.</p><button onclick="showPage('page-disclaimer-no')" class="btn btn-primary" data-translate-key="continue_btn">Continue</button></div></div>
    </div>

    <!-- CHAT WIDGET HTML -->
    <div id="chat-bubble"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></div>
    <div id="chat-widget"><div id="chat-header" data-translate-key="chat_header">AI Assistant</div><div id="chat-messages"></div><div id="chat-input-area"><button id="mic-btn" class="chat-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg></button><input type="text" id="chat-input" data-translate-key="chat_placeholder" placeholder="Ask a question..."><button id="send-btn" class="chat-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div></div>

    <!-- VOICE RECORDING OVERLAY HTML -->
    <div id="voice-overlay"><div id="voice-visualizer"><svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg></div><button id="stop-recording-btn" data-translate-key="stop_btn">Stop</button></div>

    <script>
        // --- CONFIGURATION ---
        const bookingUrl = 'https://tokyogirlshub.com/en/booking';
        const n8nWebhookUrl = 'https://tokyogirlshub.app.n8n.cloud/webhook/d01e21eb-14c0-41bf-8c7f-cee5a5e3371d'; 
        let currentLanguage = 'en';
        let pageHistory = [];
        let chatHistory = [];

        // --- TRANSLATION DATA ---
        const translations = {
            'en': { stop_btn: "Stop", /* ... other keys */ select_language_title: "Select Your Language", search_placeholder: "Search for a language...", welcome: "Welcome", first_time_title: "Is this your first time with us?", yes_btn: "Yes", no_btn: "No", our_services_title: "Our Services", our_services_subtitle: "We're a legally registered agency offering these services:", ok_btn: "I Understand", legal_reminder_title: "âš–ï¸ Legal Reminder", legal_reminder_text: "In Japan, paying for intercourse is strictly illegal. ğŸš«<br><br>We fully comply with the law, so please do not request this service.<br><br>Payment is for our companion's time and delightful company only. Thank you for your understanding! ğŸ˜Š", confirm_btn: "I Agree", reject_btn: "I Decline", thank_you: "Thank You", rejection_text: "We appreciate your interest. Hope to see you again soon. Redirecting...", welcome_back: "Welcome Back!", which_girl_title: "Which companion did you see last time?", which_girl_subtitle: "Letting us know helps us prepare for your visit.", girl_name_placeholder: "Her name, or 'Not Sure'", submit_continue_btn: "Submit & Continue", confirm_booking_btn: "Confirm & Proceed to Booking", form_success_text: "Thank you, we've noted your preference.", form_success_subtitle: "Please continue to the legal reminder.", continue_btn: "Continue", services: ["Kissing", "Handjob", "Ball Licking", "Blowjob", "Touching", "Body Licking", "69", "Massage", "Cuddling"], back_btn: "â€¹", chat_header: "AI Assistant", chat_placeholder: "Ask a question..." },
            'ja': { stop_btn: "åœæ­¢", /* ... other keys */ select_language_title: "è¨€èªã‚’é¸æŠã—ã¦ãã ã•ã„", search_placeholder: "è¨€èªã‚’æ¤œç´¢...", welcome: "ã‚ˆã†ã“ã", first_time_title: "åˆã‚ã¦ã®ã”åˆ©ç”¨ã§ã™ã‹ï¼Ÿ", yes_btn: "ã¯ã„", no_btn: "ã„ã„ãˆ", our_services_title: "ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹", our_services_subtitle: "å½“åº—ã¯åˆæ³•çš„ã«èªå¯ã•ã‚ŒãŸåº—èˆ—ã§ã™ã€‚ä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã”æä¾›ã—ã¦ãŠã‚Šã¾ã™ã€‚", ok_btn: "äº†è§£ã—ã¾ã—ãŸ", legal_reminder_title: "âš–ï¸ é‡è¦ãªãŠçŸ¥ã‚‰ã›", legal_reminder_text: "æ—¥æœ¬ã§ã¯ã€å¯¾ä¾¡ã‚’ä¼´ã†æ€§äº¤æ¸‰ã¯æ³•å¾‹ã§å›ºãç¦ã˜ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ğŸš«<br><br>å½“åº—ã¯æ³•å¾‹ã‚’éµå®ˆã—ã¦ãŠã‚Šã¾ã™ã®ã§ã€ãã®ã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã®ã”è¦æ±‚ã¯ã”é æ…®ãã ã•ã„ã€‚<br><br>æ–™é‡‘ã¯ã‚ãã¾ã§ã€ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ã®æ™‚é–“ã¨æ¥½ã—ã„ä¼šè©±ã«å¯¾ã—ã¦ã®ã‚‚ã®ã§ã™ã€‚ã”ç†è§£ã”å”åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚ğŸ˜Š", confirm_btn: "åŒæ„ã—ã¾ã™", reject_btn: "åŒæ„ã—ã¾ã›ã‚“", thank_you: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", rejection_text: "ã”é–¢å¿ƒã‚’ãŠå¯„ã›ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã¾ãŸã®ã”åˆ©ç”¨ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸­...", welcome_back: "ãŠã‹ãˆã‚Šãªã•ã„ã¾ã›ï¼", which_girl_title: "å‰å›ã”æŒ‡åã®ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ã¯ï¼Ÿ", which_girl_subtitle: "ãŠæ°—ã«å…¥ã‚Šã®å­ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨ã€ã‚¹ãƒ ãƒ¼ã‚ºã«ã”æ¡ˆå†…ã§ãã¾ã™ã€‚", girl_name_placeholder: "ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³åã€ã¾ãŸã¯ã€Œè¦šãˆã¦ã„ãªã„ã€", submit_continue_btn: "é€ä¿¡ã—ã¦ç¶šã‘ã‚‹", confirm_booking_btn: "ç¢ºèªã—ã¦äºˆç´„ã«é€²ã‚€", form_success_text: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã”å¸Œæœ›ã‚’æ‰¿ã‚Šã¾ã—ãŸã€‚", form_success_subtitle: "ç¶šã„ã¦ã€æ³¨æ„äº‹é …ã®ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚", continue_btn: "ç¶šã‘ã‚‹", services: ["ã‚­ã‚¹", "ãƒãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–", "ãƒœãƒ¼ãƒ«èˆã‚", "ãƒ•ã‚§ãƒ©ãƒã‚ª", "ãƒœãƒ‡ã‚£ã‚¿ãƒƒãƒ", "å…¨èº«èˆã‚", "ã‚·ãƒƒã‚¯ã‚¹ãƒŠã‚¤ãƒ³", "ãƒãƒƒã‚µãƒ¼ã‚¸", "æ·»ã„å¯"], back_btn: "â€¹", chat_header: "AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ", chat_placeholder: "è³ªå•ã‚’å…¥åŠ›..." },
            'zh': { stop_btn: "åœæ­¢", /* ... other keys */ select_language_title: "è¯·é€‰æ‹©æ‚¨çš„è¯­è¨€", search_placeholder: "æœç´¢è¯­è¨€...", welcome: "æ¬¢è¿å…‰ä¸´", first_time_title: "æ˜¯ç¬¬ä¸€æ¬¡æ¥å—ï¼Ÿ", yes_btn: "æ˜¯", no_btn: "ä¸æ˜¯", our_services_title: "æœåŠ¡é¡¹ç›®", our_services_subtitle: "æˆ‘ä»¬æ˜¯åˆæ³•æ³¨å†Œçš„åº—é“ºï¼Œä¸ºæ‚¨æä¾›ä»¥ä¸‹æœåŠ¡é¡¹ç›®ï¼š", ok_btn: "æˆ‘æ˜ç™½äº†", legal_reminder_title: "âš–ï¸ æ³•å¾‹æé†’", legal_reminder_text: "åœ¨æ—¥æœ¬ï¼Œä»˜è´¹æ€§äº¤æ˜“æ˜¯ä¸¥æ ¼è¿æ³•çš„ã€‚ğŸš«<br><br>æˆ‘ä»¬ä¸¥æ ¼éµå®ˆæ³•å¾‹ï¼Œè¯·ä¸è¦æå‡ºæ­¤ç±»æœåŠ¡è¦æ±‚ã€‚<br><br>æ‚¨çš„è´¹ç”¨ä»…ç”¨äºå¥³ä¼´çš„å®è´µæ—¶é—´ä¸æ„‰å¿«é™ªä¼´ã€‚æ„Ÿè°¢æ‚¨çš„ç†è§£ä¸åˆä½œï¼ğŸ˜Š", confirm_btn: "æˆ‘åŒæ„", reject_btn: "æˆ‘æ‹’ç»", thank_you: "è°¢è°¢æ‚¨", rejection_text: "æ„Ÿè°¢æ‚¨çš„å…‰ä¸´ï¼ŒæœŸå¾…ä¸‹æ¬¡èƒ½ä¸ºæ‚¨æœåŠ¡ã€‚é¡µé¢è·³è½¬ä¸­...", welcome_back: "æ¬¢è¿å›æ¥ï¼", which_girl_title: "ä¸Šæ¬¡æ‚¨é€‰æ‹©çš„å¥³ä¼´æ˜¯å“ªä½ï¼Ÿ", which_girl_subtitle: "å‘Šè¯‰æˆ‘ä»¬èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä¸ºæ‚¨å‡†å¤‡ã€‚", girl_name_placeholder: "å¥¹çš„åå­—ï¼Œæˆ–â€œä¸ç¡®å®šâ€", submit_continue_btn: "æäº¤å¹¶ç»§ç»­", confirm_booking_btn: "ç¡®è®¤å¹¶ç»§ç»­é¢„è®¢", form_success_text: "è°¢è°¢ï¼Œæˆ‘ä»¬å·²è®°å½•æ‚¨çš„åå¥½ã€‚", form_success_subtitle: "è¯·ç»§ç»­é˜…è¯»æ³•å¾‹æé†’ã€‚", continue_btn: "ç»§ç»­", services: ["æ¥å»", "æ‰‹äº¤", "èˆ”è›‹", "å£äº¤", "è§¦æ‘¸", "èˆ”å…¨èº«", "69", "æŒ‰æ‘©", "æ‹¥æŠ±"], back_btn: "â€¹", chat_header: "AI åŠ©æ‰‹", chat_placeholder: "è¾“å…¥æ‚¨çš„é—®é¢˜..." },
            'ko': { stop_btn: "ì¤‘ì§€", /* ... other keys */ select_language_title: "ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”", search_placeholder: "ì–¸ì–´ ê²€ìƒ‰...", welcome: "ì–´ì„œ ì˜¤ì„¸ìš”", first_time_title: "ì²˜ìŒ ë°©ë¬¸ì´ì‹ ê°€ìš”?", yes_btn: "ë„¤", no_btn: "ì•„ë‹ˆìš”", our_services_title: "ì„œë¹„ìŠ¤ ì•ˆë‚´", our_services_subtitle: "ì €í¬ëŠ” í•©ë²•ì ìœ¼ë¡œ ë“±ë¡ëœ ì—…ì²´ì´ë©°, ë‹¤ìŒê³¼ ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤:", ok_btn: "ì´í•´í–ˆìŠµë‹ˆë‹¤", legal_reminder_title: "âš–ï¸ ë²•ì  ê³ ì§€", legal_reminder_text: "ì¼ë³¸ì—ì„œëŠ” ê¸ˆì „ì„ ëŒ€ê°€ë¡œ í•œ ì„±ê´€ê³„ëŠ” ì—„ê²©íˆ ê¸ˆì§€ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ğŸš«<br><br>ì €í¬ëŠ” ë²•ì„ ì¤€ìˆ˜í•˜ë¯€ë¡œ, í•´ë‹¹ ì„œë¹„ìŠ¤ ìš”ì²­ì€ ì‚¼ê°€ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.<br><br>ì§€ë¶ˆí•˜ì‹œëŠ” ë¹„ìš©ì€ ì˜¤ì§ ì»´íŒ¨ë‹ˆì–¸ì˜ ì‹œê°„ê³¼ ì¦ê±°ìš´ ëŒ€í™”ì— ëŒ€í•œ ê²ƒì…ë‹ˆë‹¤. ì´í•´ì™€ í˜‘ì¡°ì— ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ˜Š", confirm_btn: "ë™ì˜í•©ë‹ˆë‹¤", reject_btn: "ê±°ë¶€í•©ë‹ˆë‹¤", thank_you: "ê°ì‚¬í•©ë‹ˆë‹¤", rejection_text: "ê´€ì‹¬ ê°€ì ¸ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë‹¤ì‹œ ëµ™ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ë¦¬ë””ë ‰ì…˜ ì¤‘...", welcome_back: "ë‹¤ì‹œ ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!", which_girl_title: "ì§€ë‚œë²ˆì— ì–´ë–¤ ì»´íŒ¨ë‹ˆì–¸ê³¼ í•¨ê»˜í•˜ì…¨ë‚˜ìš”?", which_girl_subtitle: "ë” ë‚˜ì€ ì¤€ë¹„ë¥¼ ìœ„í•´ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.", girl_name_placeholder: "ì´ë¦„ ë˜ëŠ” 'ì˜ ëª¨ë¥´ê² ì–´ìš”'", submit_continue_btn: "ì œì¶œí•˜ê³  ê³„ì†í•˜ê¸°", confirm_booking_btn: "í™•ì¸í•˜ê³  ì˜ˆì•½ ì§„í–‰", form_success_text: "ê°ì‚¬í•©ë‹ˆë‹¤, ì„ í˜¸ ì‚¬í•­ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.", form_success_subtitle: "ë²•ì  ê³ ì§€ ì‚¬í•­ìœ¼ë¡œ ì§„í–‰í•´ ì£¼ì„¸ìš”.", continue_btn: "ê³„ì†", services: ["í‚¤ìŠ¤", "í•¸ë“œì¡", "ë³¼ í•¥ê¸°", "ë¸”ë¡œìš°ì¡", "í„°ì¹˜", "ë°”ë”” í•¥ê¸°", "69", "ë§ˆì‚¬ì§€", "í¬ì˜¹"], back_btn: "â€¹", chat_header: "AI ì–´ì‹œìŠ¤í„´íŠ¸", chat_placeholder: "ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." },
            'es': { stop_btn: "Parar", /* ... other keys */ select_language_title: "Seleccione su idioma", search_placeholder: "Buscar un idioma...", welcome: "Bienvenido", first_time_title: "Â¿Es su primera vez con nosotros?", yes_btn: "SÃ­", no_btn: "No", our_services_title: "Nuestros Servicios", our_services_subtitle: "Somos una agencia legalmente registrada y ofrecemos los siguientes servicios:", ok_btn: "Entendido", legal_reminder_title: "âš–ï¸ Recordatorio Legal", legal_reminder_text: "En JapÃ³n, pagar por relaciones sexuales estÃ¡ estrictamente prohibido por ley. ğŸš«<br><br>Cumplimos plenamente con la ley, por favor no solicite este servicio.<br><br>El pago es Ãºnicamente por el tiempo y la encantadora compaÃ±Ã­a de nuestras acompaÃ±antes. Â¡Gracias por su comprensiÃ³n! ğŸ˜Š", confirm_btn: "Acepto", reject_btn: "Rechazo", thank_you: "Gracias", rejection_text: "Agradecemos su interÃ©s. Esperamos verle de nuevo. Redirigiendo...", welcome_back: "Â¡Bienvenido de nuevo!", which_girl_title: "Â¿QuÃ© acompaÃ±ante vio la Ãºltima vez?", which_girl_subtitle: "Saberlo nos ayuda a preparar su visita.", girl_name_placeholder: "Su nombre, o 'No estoy seguro'", submit_continue_btn: "Enviar y Continuar", confirm_booking_btn: "Confirmar y Proceder a la Reserva", form_success_text: "Gracias, hemos anotado su preferencia.", form_success_subtitle: "Por favor, continÃºe con el aviso legal.", continue_btn: "Continuar", services: ["Besos", "MasturbaciÃ³n", "Lamer testÃ­culos", "Sexo oral", "Tocar", "Lamer el cuerpo", "69", "Masaje", "Abrazos"], back_btn: "â€¹", chat_header: "Asistente de IA", chat_placeholder: "Haga una pregunta..." },
            'zh-tw': { stop_btn: "åœæ­¢", /* ... other keys */ select_language_title: "è«‹é¸æ“‡æ‚¨çš„èªè¨€", search_placeholder: "æœå°‹èªè¨€...", welcome: "æ­¡è¿å…‰è‡¨", first_time_title: "æ˜¯ç¬¬ä¸€æ¬¡ä¾†å—ï¼Ÿ", yes_btn: "æ˜¯", no_btn: "ä¸æ˜¯", our_services_title: "æœå‹™é …ç›®", our_services_subtitle: "æˆ‘å€‘æ˜¯åˆæ³•è¨»å†Šçš„åº—å®¶ï¼Œç‚ºæ‚¨æä¾›ä»¥ä¸‹æœå‹™é …ç›®ï¼š", ok_btn: "æˆ‘æ˜ç™½äº†", legal_reminder_title: "âš–ï¸ æ³•å¾‹æé†’", legal_reminder_text: "åœ¨æ—¥æœ¬ï¼Œä»˜è²»æ€§äº¤æ˜“æ˜¯åš´æ ¼ç¦æ­¢çš„é•æ³•è¡Œç‚ºã€‚ğŸš«<br><br>æˆ‘å€‘åš´æ ¼éµå®ˆæ³•å¾‹ï¼Œè«‹ä¸è¦æå‡ºæ­¤é¡æœå‹™è¦æ±‚ã€‚<br><br>æ‚¨çš„è²»ç”¨åƒ…ç”¨æ–¼å¥³ä¼´çš„å¯¶è²´æ™‚é–“èˆ‡æ„‰å¿«é™ªä¼´ã€‚æ„Ÿè¬æ‚¨çš„ç†è§£èˆ‡åˆä½œï¼ğŸ˜Š", confirm_btn: "æˆ‘åŒæ„", reject_btn: "æˆ‘æ‹’çµ•", thank_you: "è¬è¬æ‚¨", rejection_text: "æ„Ÿè¬æ‚¨çš„å…‰è‡¨ï¼ŒæœŸå¾…ä¸‹æ¬¡èƒ½ç‚ºæ‚¨æœå‹™ã€‚é é¢è·³è½‰ä¸­...", welcome_back: "æ­¡è¿å›ä¾†ï¼", which_girl_title: "ä¸Šæ¬¡æ‚¨é¸æ“‡çš„å¥³ä¼´æ˜¯å“ªä½ï¼Ÿ", which_girl_subtitle: "å‘Šè¨´æˆ‘å€‘èƒ½å¹«åŠ©æˆ‘å€‘æ›´å¥½åœ°ç‚ºæ‚¨æº–å‚™ã€‚", girl_name_placeholder: "å¥¹çš„åå­—ï¼Œæˆ–ã€Œä¸ç¢ºå®šã€", submit_continue_btn: "æäº¤ä¸¦ç¹¼çºŒ", confirm_booking_btn: "ç¢ºèªä¸¦ç¹¼çºŒé è¨‚", form_success_text: "è¬è¬ï¼Œæˆ‘å€‘å·²è¨˜éŒ„æ‚¨çš„åå¥½ã€‚", form_success_subtitle: "è«‹ç¹¼çºŒé–±è®€æ³•å¾‹æé†’ã€‚", continue_btn: "ç¹¼çºŒ", services: ["æ¥å»", "æ‰‹äº¤", "èˆ”è›‹", "å£äº¤", "è§¸æ‘¸", "èˆ”å…¨èº«", "69", "æŒ‰æ‘©", "æ“æŠ±"], back_btn: "â€¹", chat_header: "AI åŠ©ç†", chat_placeholder: "è¼¸å…¥æ‚¨çš„å•é¡Œ..." }
        };
        
        const languageOptions = [ { code: 'en', name: "English" }, { code: 'ja', name: "æ—¥æœ¬èª (Japanese)" }, { code: 'zh', name: "ä¸­æ–‡ (ç®€ä½“)" }, { code: 'ko', name: "í•œêµ­ì–´ (Korean)" }, { code: 'es', name: "EspaÃ±ol (Spanish)" }, { code: 'zh-tw', name: "ä¸­æ–‡ (ç¹é«” - å»£æ±è©±/å°ç£è©±)" } ];

        // --- CORE FUNCTIONS (Updated Language Selection) ---
        function updateText() { const langPack = translations[currentLanguage] || translations['en']; document.querySelectorAll('[data-translate-key]').forEach(el => { const key = el.getAttribute('data-translate-key'); if (langPack[key]) { if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { el.placeholder = langPack[key]; } else { el.innerHTML = langPack[key]; } } }); populateServices(); }
        
        function populateLanguages() {
            const select = document.getElementById('language-select');
            select.innerHTML = '';
            languageOptions.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang.code;
                option.textContent = lang.name;
                select.appendChild(option);
            });
        }
        
        document.getElementById('language-continue-btn').addEventListener('click', () => {
            const select = document.getElementById('language-select');
            currentLanguage = select.value;
            showPage('page-first-time');
        });

        function populateServices() { const grid = document.querySelector('#page-services .grid'); const services = translations[currentLanguage].services || translations['en'].services; grid.innerHTML = ''; services.forEach(service => { const card = document.createElement('div'); card.className = 'service-card'; card.innerHTML = `<img src="https://placehold.co/200x200/fbcfe8/be185d?text=${service.charAt(0)}" alt="${service}"><p>${service}</p>`; grid.appendChild(card); }); }
        function showPage(pageId, isGoingBack = false) { const currentPage = document.querySelector('.page.active'); if (currentPage && !isGoingBack) { pageHistory.push(currentPage.id); } document.querySelectorAll('.page').forEach(page => page.classList.remove('active')); const targetPage = document.getElementById(pageId); if (targetPage) { targetPage.classList.add('active'); updateText(); } }
        function goBack() { if (pageHistory.length > 0) { const prevPageId = pageHistory.pop(); showPage(prevPageId, true); } }
        function redirectToBooking() { window.location.href = bookingUrl; }
        function handleRejection() { showPage('page-rejected'); setTimeout(() => { pageHistory = []; showPage('page-language'); }, 10000); }
        document.getElementById('girl-nomination-form').addEventListener("submit", async function(event) { event.preventDefault(); const girlName = new FormData(event.target).get('girl_name'); const payload = { type: "nomination", payload: { girl_name: girlName, submitted_at: new Date().toISOString() } }; try { const response = await fetch(n8nWebhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (response.ok) { showPage('page-form-success'); } else { console.error('Webhook submission failed, but proceeding.'); showPage('page-disclaimer-no'); } } catch (error) { console.error('Error submitting to webhook:', error); showPage('page-disclaimer-no'); } });

        // --- CHAT WIDGET LOGIC ---
        const chatWidget = document.getElementById('chat-widget');
        const chatBubble = document.getElementById('chat-bubble');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const micBtn = document.getElementById('mic-btn');
        chatBubble.addEventListener('click', () => chatWidget.classList.toggle('active'));
        function addChatMessage(message, sender) { const msgDiv = document.createElement('div'); msgDiv.className = `chat-message ${sender}-message`; msgDiv.textContent = message; chatMessages.appendChild(msgDiv); chatMessages.scrollTop = chatMessages.scrollHeight; }
        async function handleSendMessage() { const message = chatInput.value.trim(); if (!message) return; addChatMessage(message, 'user'); chatHistory.push({ role: 'user', content: message }); chatInput.value = ''; const payload = { type: "chat", payload: { message: message, history: chatHistory, language: currentLanguage } }; try { const response = await fetch(n8nWebhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); const data = await response.json(); const aiResponse = data.response || "Sorry, I couldn't process that."; addChatMessage(aiResponse, 'ai'); chatHistory.push({ role: 'ai', content: aiResponse }); speakText(aiResponse); } catch (error) { console.error("Chat error:", error); addChatMessage("Sorry, an error occurred.", 'ai'); } }
        sendBtn.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSendMessage(); });

        // --- VOICE RECORDING & TEXT-TO-SPEECH ---
        const voiceOverlay = document.getElementById('voice-overlay');
        const stopRecordingBtn = document.getElementById('stop-recording-btn');
        const visualizer = document.getElementById('voice-visualizer');
        let mediaRecorder;
        let audioChunks = [];
        let audioContext, analyser, dataArray, source, rafId;

        function speakText(text) { window.speechSynthesis.cancel(); const utterance = new SpeechSynthesisUtterance(text); window.speechSynthesis.speak(utterance); }
        
        async function sendAudioToWebhook(audioBase64) {
            const payload = { type: "audio_chat", payload: { audio_base64: audioBase64, language: currentLanguage, history: chatHistory } };
            try {
                const response = await fetch(n8nWebhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const data = await response.json();
                const transcribedText = data.transcribed_text || "Couldn't hear that.";
                const aiResponse = data.response || "Sorry, I couldn't process that.";
                
                addChatMessage(transcribedText, 'user');
                chatHistory.push({ role: 'user', content: transcribedText });
                
                addChatMessage(aiResponse, 'ai');
                chatHistory.push({ role: 'ai', content: aiResponse });
                
                speakText(aiResponse);
            } catch (error) {
                console.error("Audio chat error:", error);
                addChatMessage("Sorry, an error occurred with my ears.", 'ai');
            }
        }

        function visualize(stream) {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            source = audioContext.createMediaStreamSource(stream);
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            source.connect(analyser);
            
            const draw = () => {
                rafId = requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);
                let sum = dataArray.reduce((a, b) => a + b, 0);
                let avg = sum / bufferLength || 0;
                let scale = 1 + (avg / 128);
                visualizer.style.transform = `scale(${scale})`;
            };
            draw();
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                visualize(stream);
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();
                voiceOverlay.style.display = 'flex';
                
                mediaRecorder.addEventListener("dataavailable", event => { audioChunks.push(event.data); });
                mediaRecorder.addEventListener("stop", () => {
                    const audioBlob = new Blob(audioChunks);
                    const reader = new FileReader();
                    reader.readAsDataURL(audioBlob);
                    reader.onloadend = () => {
                        const base64String = reader.result.split(',')[1];
                        sendAudioToWebhook(base64String);
                    };
                    audioChunks = [];
                    stream.getTracks().forEach(track => track.stop());
                    cancelAnimationFrame(rafId);
                    visualizer.style.transform = 'scale(1)';
                });
            } catch (err) {
                console.error("Error accessing microphone:", err);
                alert("Microphone access is required for voice chat. Please allow access and try again.");
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
            }
            voiceOverlay.style.display = 'none';
        }

        micBtn.addEventListener('click', startRecording);
        stopRecordingBtn.addEventListener('click', stopRecording);
        
        // --- INITIALIZE APP ---
        document.addEventListener('DOMContentLoaded', () => {
            populateLanguages();
            showPage('page-language');
        });
    </script>

</body>
</html>
